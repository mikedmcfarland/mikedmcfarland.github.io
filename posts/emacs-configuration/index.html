<!DOCTYPE html><html lang="en"><head><title>Thrown for a loop</title><meta name="viewport" content="width=device-width, initial-scale=1.0"><link href="//maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet"><link rel="stylesheet" type="text/css" href="/css/bootstrap/default-bright2.css"><link rel="stylesheet" type="text/css" href="/css/main.css"><link rel="stylesheet" type="text/css" href="/css/base16-monokai.dark.css"><link href="http://fonts.googleapis.com/css?family=Raleway:800,400" rel="stylesheet" type="text/css"><!-- link(href='http://fonts.googleapis.com/css?family=Inconsolata', rel='stylesheet', type='text/css')--><link href="http://fonts.googleapis.com/css?family=Source+Code+Pro:400,600" rel="stylesheet" type="text/css"></head><body role="document" data-spy="scroll" data-target="#affix-nav"><header role="navigation" class="navbar navbar-inverse shadow"><nav class="container"><div class="navbar-header"><a href="/" class="navbar-brand"> <img src="/img/logo.png" alt="logo" class="pull-right logo-img"><span class="logo">thrown <span class="cursor">|</span></span></a></div><div class="navbar-nav"><a role="button" data-toggle="collapse" data-target="#about" class="btn btn-lg"> about me</a></div></nav><div id="about" class="collapse"><div class="container"> <ul class="media-list"><li><div class="media-left media-middle"><img src="/img/me_big.jpg" class="img-circle img-responsive"></div><div class="media-body media-middle"><p>Hi, My name is <strong>Mike McFarland </strong>. I have an infatuation with programming which has lead me to creating games and interactive applications. 
I enjoy talking about technology, and made <strong>thrown for a loop </strong>to help me do so while giving those around me a rest.</p></div></li><li><div class="media-left media-middle"><img src="/img/game.jpg" class="img-rounded img-responsive"></div><div class="media-body media-middle"><p>As you read this I'm working on a <strong>puzzle strategy game</strong>, which is in serious need of a name. 
In a previous life I made serious games and interactives for <a href="http://secondavenuelearning.com/">Second Avenue Learning</a>, until I made the leap and left to focus on my own
projects. Ill post updates about those here.</p></div></li><li><div class="media-left media-middle"><div id="contact"><i class="fa fa-github-square"></i><i class="fa fa-bitbucket-square"></i><i class="fa fa-linkedin-square"></i></div></div><div class="media-body media-middle"><p>Interested in working together?  Feel free to contact me.</p></div></li></ul></div></div></header></body><div role="main" class="container"><h1 id="page-header" class="page-header invert">Emacs Configuration</h1><h5 class="invert page-date">1-29-2015</h5><div class="row"><div id="content" class="col-md-8"><article id="post"><div id="outline-container-sec-1" class="outline-2">
<h2 id="sec-1">About</h2>
<div class="outline-text-2" id="text-1">
</div><div id="outline-container-sec-1-1" class="outline-3">
<h3 id="sec-1-1">This File</h3>
<div class="outline-text-3" id="text-1-1">
<p>
This is an emacs org-mode file which generates my personal emacs
configuration. These settings are used along side <a href="http://github.com/bbatsov/prelude">Emacs Prelude</a>. I
share my config across multiple machines and use git to version it.
<a href="http://github.com/mikedmcfarland/emacs-config">Here is my configuration on github</a>.
</p>
</div>
</div>

<div id="outline-container-sec-1-2" class="outline-3">
<h3 id="sec-1-2">This  Emacs Config</h3>
<div class="outline-text-3" id="text-1-2">
<p>
My workflow involves running mainly one window in a frame. And
running many frames at once (all in daemon mode). Many settings are
a consequence of this.
</p>

<p>
<b>Why?</b>
</p>

<p>
I run emacs in a <a href="http://i3wm.org">tiling window manager</a>, it takes care of tabing and
window management needs. Its nicer when all my programs operate
tabs/windowing consistently.
</p>
</div>
</div>
</div>

<div id="outline-container-sec-2" class="outline-2">
<h2 id="sec-2">Emacs initialization</h2>
<div class="outline-text-2" id="text-2">
</div><div id="outline-container-sec-2-1" class="outline-3">
<h3 id="sec-2-1">Personal Information</h3>
<div class="outline-text-3" id="text-2-1">
<p>
Set my name and email
</p>
<div class="org-src-container">

<div class="invert"><pre><code class="language-scheme">(setq user-full-name "Mike McFarland"
      user-mail-address "mikedmcfarland@gmail.com")
</code></pre></div>
</div>
</div>
</div>

<div id="outline-container-sec-2-2" class="outline-3">
<h3 id="sec-2-2">Prelude Modules</h3>
<div class="outline-text-3" id="text-2-2">
<p>
Prelude includes many packages you can toggle. Here's <a href="https://github.com/mikedmcfarland/emacs-config/blob/master/prelude-modules.el">the list</a> I enabled.
</p>
</div>
</div>


<div id="outline-container-sec-2-3" class="outline-3">
<h3 id="sec-2-3">Packages</h3>
<div class="outline-text-3" id="text-2-3">
<p>
My required packages, prelude will make sure these are downloaded
and required at startup.
</p>
<div class="org-src-container">

<div class="invert"><pre><code class="language-scheme">(prelude-require-packages
 '(s
   monokai-theme
   restclient
   powerline-evil
   yasnippet
   multiple-cursors
   expand-region
   evil-nerd-commenter
   js2-refactor
   ))
</code></pre></div>
</div>
</div>
</div>

<div id="outline-container-sec-2-4" class="outline-3">
<h3 id="sec-2-4">Backups</h3>
<div class="outline-text-3" id="text-2-4">
<p>
store backups in one folder instead next to the file
</p>
<div class="org-src-container">

<div class="invert"><pre><code class="language-scheme">(setq backup-directory-alist `(("." . "~/.emacs.d/.backups")))
</code></pre></div>
</div>
</div>
</div>

<div id="outline-container-sec-2-5" class="outline-3">
<h3 id="sec-2-5">Save Place</h3>
<div class="outline-text-3" id="text-2-5">
<p>
Save cursor position when reopening a file
</p>
<div class="org-src-container">

<div class="invert"><pre><code class="language-scheme">(setq save-place-file "~/.emacs.d/saveplace")
(setq-default save-place t)
(require 'saveplace)
</code></pre></div>
</div>
</div>
</div>

<div id="outline-container-sec-2-6" class="outline-3">
<h3 id="sec-2-6">Aesthetics</h3>
<div class="outline-text-3" id="text-2-6">
<p>
Load the monokai theme (Sublime Text's default colors)
</p>
<div class="org-src-container">

<div class="invert"><pre><code class="language-scheme">(load-theme 'monokai t)
</code></pre></div>
</div>

<p>
Make sure we edit using visual lines, instead of actual line breaks.
Helps when word wrapping is on.
</p>
<div class="org-src-container">

<div class="invert"><pre><code class="language-scheme">(global-visual-line-mode t)
</code></pre></div>
</div>

<p>
set the font, this seems to work for the emacs daemon, other methods
were requiring me to re-run expressions after connecting another client
</p>
<div class="org-src-container">

<div class="invert"><pre><code class="language-scheme">(add-to-list 'default-frame-alist '(font .   "Source Code Pro 12" ))
</code></pre></div>
</div>

<p>
A few miscallaneious things
</p>
<div class="org-src-container">

<div class="invert"><pre><code class="language-scheme"> (display-time-mode t)

 ;;smooth scrolling
 (setq scroll-margin 5
       scroll-conservatively 9999
       scroll-step 1)

(defun set-my-margins()
  (setq left-margin-width 1)
  (setq right-margin-width 1))

(add-hook 'text-mode-hook 'set-my-margins)
(add-hook 'prog-mode-hook 'set-my-margins)

(powerline-evil-vim-color-theme)
</code></pre></div>
</div>
</div>

<div id="outline-container-sec-2-6-1" class="outline-4">
<h4 id="sec-2-6-1"><span class="todo TODO">TODO</span> make margins dynamic</h4>
<div class="outline-text-4" id="text-2-6-1">
<p>
currently we have static margins, it'd be nice to allow things to look
centered when there's plenty of room (fullscreen)
</p>
</div>
</div>
</div>
</div>


<div id="outline-container-sec-3" class="outline-2">
<h2 id="sec-3">Javascript</h2>
<div class="outline-text-2" id="text-3">
</div><div id="outline-container-sec-3-1" class="outline-3">
<h3 id="sec-3-1">js2 refactor</h3>
<div class="outline-text-3" id="text-3-1">
<p>
set js refactors prefix
</p>
<div class="org-src-container">

<div class="invert"><pre><code class="language-scheme">(js2r-add-keybindings-with-prefix (kbd "C-c C-r"))
</code></pre></div>
</div>
</div>
</div>
<div id="outline-container-sec-3-2" class="outline-3">
<h3 id="sec-3-2">Indentation</h3>
<div class="outline-text-3" id="text-3-2">
<p>
Two spaces is nice. Set it as default, and set evils shift width
when in js mode as well.
</p>
<div class="org-src-container">

<div class="invert"><pre><code class="language-scheme">(setq-default js-indent-level 2)
(add-hook 'prelude-js-mode-hook
	  (lambda() (setq evil-shift-width 2)))

(setq-default js2-basic-offset 2)
</code></pre></div>
</div>
</div>
</div>

<div id="outline-container-sec-3-3" class="outline-3">
<h3 id="sec-3-3">js2 settings</h3>
<div class="outline-text-3" id="text-3-3">
<p>
Highlighting/style settings. Don't worry about semicolons. And use harmony.
</p>
<div class="org-src-container">

<div class="invert"><pre><code class="language-scheme">(setq-default js2-highlight-level 3)
(setq-default js2-highlight-external-variables t)

(setq-default js2-concat-multiline-strings t)
(setq-default js2-strict-missing-semi-warning nil)
(setq-default js2-pretty-multiline-declarations nil)

(setq-default js2-language-version 200)
</code></pre></div>
</div>

<p>
configuration so we use jslint, and allow node externs
</p>
<div class="org-src-container">

<div class="invert"><pre><code class="language-scheme">(setq-default js2-include-jslint-globals t)
(setq-default js2-include-node-externs t)
</code></pre></div>
</div>
</div>
</div>

<div id="outline-container-sec-3-4" class="outline-3">
<h3 id="sec-3-4">Jump to test or implementation</h3>
<div class="outline-text-3" id="text-3-4">
<p>
Little script for jumping between tests and implementations. Made
with a <a href="http://emacs.stackexchange.com/questions/7308/define-key-to-toggle-between-javascript-implementation-and-test-file/7316#7316">little help</a>. Expects A structure with a lib directory for
implementations, and a test directory for specs, Like so:
</p>
<div class="invert"><pre class="example">lib/foo.js
lib/someDir/bar.js
test/fooSpec.js
test/someDir/barSpec.js
</pre></div>

<div class="org-src-container">

<div class="invert"><pre><code class="language-scheme">(defun js-jump-to (current from to format-name)
  (find-file
   (cl-loop with parts = (reverse current)
	    with fname = (file-name-sans-extension (cl-first parts))
	    for (name . rest) on (cl-rest parts)
	    until (string-equal name from)
	    collect name into names
	    finally (cl-return
		     (mapconcat 'identity
				(nconc (reverse rest)
				       (list to)
				       (reverse names)
				       (list (funcall format-name fname) )) "/" )))))

(defun js-format-impl-name (fname)
  (format "%s.js" (replace-regexp-in-string "Spec" "" fname)))

(defun js-format-test-name (fname)
  (format "%sSpec.js" fname))

(defun js-jump-to-implementation-or-test ()
  (interactive)
  (let ((current (split-string (buffer-file-name) "/")))
    (cond
     ((member "test" current) (js-jump-to current "test" "lib" 'js-format-impl-name))
     ((member "lib" current)  (js-jump-to current "lib" "test" 'js-format-test-name))
     (t (error "not within a test or lib directory"))
  )))
</code></pre></div>
</div>
</div>
</div>
</div>



<div id="outline-container-sec-4" class="outline-2">
<h2 id="sec-4">Jade</h2>
<div class="outline-text-2" id="text-4">
<p>
jade-mode didn't install, so I've added it into vendor as a submodule
and am initializing it manually
</p>
<div class="org-src-container">

<div class="invert"><pre><code class="language-scheme">(add-to-list 'load-path "~/.emacs.d/vendor/jade-mode")
(require 'jade-mode)
(add-to-list 'auto-mode-alist '("\\.jade$" . jade-mode))
</code></pre></div>
</div>
</div>
</div>


<div id="outline-container-sec-5" class="outline-2">
<h2 id="sec-5">elisp</h2>
<div class="outline-text-2" id="text-5">
<p>
Emacs has warnings about documenting elisp code.
I don't follow these rules, so disable them
</p>
<div class="org-src-container">

<div class="invert"><pre><code class="language-scheme">(setq-default flycheck-disabled-checkers '(emacs-lisp-checkdoc))
</code></pre></div>
</div>
</div>
</div>



<div id="outline-container-sec-6" class="outline-2">
<h2 id="sec-6">Snippets And Autocompletion</h2>
<div class="outline-text-2" id="text-6">
</div><div id="outline-container-sec-6-1" class="outline-3">
<h3 id="sec-6-1">Yasnippet</h3>
<div class="outline-text-3" id="text-6-1">
<p>
Load YASnippet configuration
</p>
<div class="org-src-container">

<div class="invert"><pre><code class="language-scheme">(setq yas-snippet-dirs '("~/.emacs.d/snippets"))
(yas-reload-all)
(add-hook 'prog-mode-hook 'yas-minor-mode)
(add-hook 'text-mode-hook 'yas-minor-mode)
(add-hook 'org-mode-hook  'yas-minor-mode)
</code></pre></div>
</div>
</div>
</div>
<div id="outline-container-sec-6-2" class="outline-3">
<h3 id="sec-6-2">Company</h3>
<div class="outline-text-3" id="text-6-2">
<p>
Using mainly companys default prelude settings. Except I
don't want any delay in suggestions.
</p>
<div class="org-src-container">

<div class="invert"><pre><code class="language-scheme">(setq company-idle-delay 0)
</code></pre></div>
</div>
</div>
</div>

<div id="outline-container-sec-6-3" class="outline-3">
<h3 id="sec-6-3">Tab</h3>
<div class="outline-text-3" id="text-6-3">
<p>
So, Company mode and YASnippet step on each other toes. So These
functions are to help TAB have the behaviour I expect. Attempt
these actions, and do the first one that works.
</p>
<ol class="org-ol">
<li>expand yas snippet
</li>
<li>auto complete with company
</li>
<li>indent
</li>
</ol>
<div class="org-src-container">

<div class="invert"><pre><code class="language-scheme">(defun check-expansion ()
  (save-excursion
    (if (looking-at "\\_&gt;") t
      (backward-char 1)
      (if (looking-at "\\.") t
	(backward-char 1)
	(if (looking-at "-&gt;") t nil)))))

(defun do-yas-expand ()
  (let ((yas/fallback-behavior 'return-nil))
    (yas/expand)))

(defun tab-indent-or-complete ()
  (interactive)
  (if (minibufferp)
      (minibuffer-complete)
    (if (or (not yas/minor-mode)
	    (null (do-yas-expand)))
	(if (check-expansion)
	    (company-complete-common)
	  (indent-for-tab-command)))))
</code></pre></div>
</div>

<p>
I became fairly frustrated trying to bind tab, so this is a fairly
dirty way of altering the keymaps of company and yas-minor
modes.
</p>

<div class="org-src-container">

<div class="invert"><pre><code class="language-scheme">(defun bind-tab-properly ()
  "Binds tab to tab-indent-or-complete, overwritting yas and company bindings"
  (interactive)
  ;;overwrite yas and company tab mappings
  (define-key yas-minor-mode-map (kbd "&lt;tab&gt;") 'tab-indent-or-complete)
  (define-key yas-minor-mode-map (kbd "TAB") 'tab-indent-or-complete)
  (define-key company-active-map [tab] 'tab-indent-or-complete)
  (define-key company-active-map (kbd "TAB") 'tab-indent-or-complete))

(add-hook 'company-mode-hook 'bind-tab-properly)
</code></pre></div>
</div>
</div>

<div id="outline-container-sec-6-3-1" class="outline-4">
<h4 id="sec-6-3-1"><span class="todo TODO">TODO</span> make tab binding / completion a minor mode</h4>
</div>
</div>
</div>

<div id="outline-container-sec-7" class="outline-2">
<h2 id="sec-7">Custom Commands</h2>
<div class="outline-text-2" id="text-7">
</div><div id="outline-container-sec-7-1" class="outline-3">
<h3 id="sec-7-1">create-new-empty-buffer</h3>
<div class="outline-text-3" id="text-7-1">
<div class="org-src-container">

<div class="invert"><pre><code class="language-scheme">(defun create-new-empty-buffer ()
  "Open a new empty buffer."
  (interactive)
  (let ((buf (generate-new-buffer "untitled")))
    (switch-to-buffer buf)
    (funcall (and initial-major-mode))
    (setq buffer-offer-save t)))
</code></pre></div>
</div>
</div>
</div>

<div id="outline-container-sec-7-2" class="outline-3">
<h3 id="sec-7-2">just-my-main-window</h3>
<div class="outline-text-3" id="text-7-2">
<p>
This is something I created with some <a href="http://emacs.stackexchange.com/questions/7418/define-a-main-window-and-then-close-all-others/7424#7424">help</a>. The main window is
defined per frame, and at any point I may wish to close all
windows besides the main (to get back to work).
</p>

<div class="org-src-container">

<div class="invert"><pre><code class="language-scheme">(defun mark-this-window-as-main ()
  "Mark the current window as the main window."
  (interactive)
  (mapc (lambda (win) (set-window-parameter win 'main nil))
    (window-list))
  (set-window-parameter nil 'main t))

(defun get-main-window()
  "Find and return the main window or nil if non exists."
  (cl-find-if (lambda (win) (window-parameter win 'main)) (window-list)))

(defun just-my-main-window ()
  "Show only the main window"
  (interactive)
  (delete-other-windows (get-main-window)))
</code></pre></div>
</div>

<p>
Add some hooks to make sure the appropriate window is marked as
main. That'll be code and document windows.
</p>

<div class="org-src-container">

<div class="invert"><pre><code class="language-scheme">(add-hook 'prog-mode-hook 'mark-this-window-as-main)
(add-hook 'text-mode-hook 'mark-this-window-as-main)
(add-hook 'org-mode-hook 'mark-this-window-as-main)
</code></pre></div>
</div>
</div>
</div>
</div>



<div id="outline-container-sec-8" class="outline-2">
<h2 id="sec-8">Org-mode</h2>
<div class="outline-text-2" id="text-8">
</div><div id="outline-container-sec-8-1" class="outline-3">
<h3 id="sec-8-1">org-babel</h3>
<div class="outline-text-3" id="text-8-1">
<p>
language definitions for org babel
</p>
<div class="org-src-container">

<div class="invert"><pre><code class="language-scheme">(org-babel-do-load-languages
 'org-babel-load-languages
 '((js . t)
   (emacs-lisp . t)
   (scala . t)
   (sh . t)))
</code></pre></div>
</div>
</div>
</div>
</div>

<div id="outline-container-sec-9" class="outline-2">
<h2 id="sec-9">Global Key Bindings</h2>
<div class="outline-text-2" id="text-9">
<div class="org-src-container">

<div class="invert"><pre><code class="language-scheme">(global-set-key (kbd "C-c C-m") 'just-my-main-window)

(global-set-key (kbd "C-j") 'company-select-next-or-abort)
(global-set-key (kbd "C-k") 'company-select-previous-or-abort)

(global-set-key (kbd "RET") 'newline-and-indent)

(global-set-key (kbd "C-p") 'projectile-find-file)
;;Remap alt p to switching a project with projectile
(global-set-key (kbd "M-p") 'projectile-switch-project)

;;Have no idea why up and down are doing absurd things, but this helped
(global-set-key (kbd "&lt;up&gt;") 'evil-previous-visual-line)
(global-set-key (kbd "&lt;down&gt;") 'evil-next-visual-line)
(global-set-key (kbd "C-h") 'previous-buffer)
(global-set-key (kbd "C-l") 'next-buffer)
(global-set-key (kbd "C-q") 'kill-this-buffer)

(global-set-key (kbd "C-S-SPC") 'er/contract-region)
(global-set-key (kbd "C-SPC") 'er/expand-region)
</code></pre></div>
</div>
</div>

<div id="outline-container-sec-9-1" class="outline-3">
<h3 id="sec-9-1"><span class="todo TODO">TODO</span> Clean up keyboard shortcuts</h3>
<div class="outline-text-3" id="text-9-1">
<ul class="org-ul">
<li>More consistency is needed, think about appropriate prefixes.
</li>
<li>Ctrl p is a poor project launching shortcut (too many
applications use it for 'previous'
</li>
</ul>
</div>
</div>
</div>




<div id="outline-container-sec-10" class="outline-2">
<h2 id="sec-10">Evil Key Bindings</h2>
<div class="outline-text-2" id="text-10">
<div class="org-src-container">

<div class="invert"><pre><code class="language-scheme">(defun map-all-evil-states (keys action)
  "maps key combination to action for all evil modes"
  (define-key evil-normal-state-map keys action)
  (define-key evil-insert-state-map keys action)
  (define-key evil-visual-state-map keys action))

(define-key evil-insert-state-map (kbd "C-j") 'company-select-next-or-abort)
(define-key evil-insert-state-map (kbd "C-k") 'company-select-previous-or-abort)

(map-all-evil-states (kbd "C-S-r") 'js2r-rename-var)
(map-all-evil-states (kbd "C-S-l") 'js2r-log-this)
(map-all-evil-states (kbd "C-t")   'js-jump-to-implementation-or-test)

;;map control p to finding a file with projectile
(map-all-evil-states (kbd "C-p") 'projectile-find-file)

;;have j and k go down to next visual line
(define-key evil-normal-state-map (kbd "j") 'evil-next-visual-line)
(define-key evil-normal-state-map (kbd "k") 'evil-previous-visual-line)

(map-all-evil-states (kbd "C-s") 'save-buffer)
(map-all-evil-states (kbd "C-n") 'create-new-empty-buffer)
(map-all-evil-states (kbd "C-/") 'evilnc-comment-or-uncomment-lines)
(define-key evil-normal-state-map (kbd "gp") 'evil-select-last-yanked-text)
</code></pre></div>
</div>
</div>
</div>


<div id="outline-container-sec-11" class="outline-2">
<h2 id="sec-11">Evil</h2>
<div class="outline-text-2" id="text-11">
<p>
Evil is an emulation layer for Vim ontop of emacs. It's a very faithful emulation.
</p>
</div>

<div id="outline-container-sec-11-1" class="outline-3">
<h3 id="sec-11-1">Select last yanked text</h3>
<div class="outline-text-3" id="text-11-1">
<p>
This function will select whatever texted you pasted last (in the buffer).
</p>
<div class="org-src-container">

<div class="invert"><pre><code class="language-scheme">(defun evil-select-last-yanked-text ()
  "uses evils markers to select the last yanked text"
  (interactive)
  (evil-goto-mark ?\[)
  (evil-visual-char)
  (evil-goto-mark ?\]))
</code></pre></div>
</div>
</div>
</div>
<div id="outline-container-sec-11-2" class="outline-3">
<h3 id="sec-11-2">kj to exit insert mode</h3>
<div class="outline-text-3" id="text-11-2">
<p>
kj is more convenient then escape for exiting insert mode
</p>
<div class="org-src-container">

<div class="invert"><pre><code class="language-scheme">;;Define KJ as espace while in insert
(define-key evil-insert-state-map "k" #'cofi/maybe-exit)

(evil-define-command cofi/maybe-exit ()
  :repeat change
  (interactive)
  (let ((modified (buffer-modified-p)))
    (insert "k")
    (let ((evt (read-event (format "Insert %c to exit insert state" ?j)
			   nil 0.5)))
      (cond
       ((null evt) (message ""))
       ((and (integerp evt) (char-equal evt ?j))
	(delete-char -1)
	(set-buffer-modified-p modified)
	(push 'escape unread-command-events))
       (t (setq unread-command-events (append unread-command-events
					      (list evt))))))))
</code></pre></div>
</div>
</div>
</div>

<div id="outline-container-sec-11-3" class="outline-3">
<h3 id="sec-11-3">Escape should exit things</h3>
<div class="outline-text-3" id="text-11-3">
<p>
Stole this from somewhere, attempts to map escape to various
exits. It isn't perfect however, and I still need ctrl g from time
to time.
</p>
<div class="org-src-container">

<div class="invert"><pre><code class="language-scheme">(defun minibuffer-keyboard-quit ()
  "Abort recursive edit.
In Delete Selection mode, if the mark is active, just deactivate it;
then it takes a second \\[keyboard-quit] to abort the minibuffer."
  (interactive)
  (if (and delete-selection-mode transient-mark-mode mark-active)
      (setq deactivate-mark  t)
    (when (get-buffer "*Completions*") (delete-windows-on "*Completions*"))
    (abort-recursive-edit)))

(define-key evil-normal-state-map [escape] 'keyboard-quit)
(define-key evil-visual-state-map [escape] 'keyboard-quit)
(define-key minibuffer-local-map [escape] 'minibuffer-keyboard-quit)
(define-key minibuffer-local-ns-map [escape] 'minibuffer-keyboard-quit)
(define-key minibuffer-local-completion-map [escape] 'minibuffer-keyboard-quit)
(define-key minibuffer-local-must-match-map [escape] 'minibuffer-keyboard-quit)
(define-key minibuffer-local-isearch-map [escape] 'minibuffer-keyboard-quit)
(global-set-key [escape] 'evil-exit-emacs-state)
</code></pre></div>
</div>
</div>

<div id="outline-container-sec-11-3-1" class="outline-4">
<h4 id="sec-11-3-1"><span class="todo TODO">TODO</span> Make escape work consitently</h4>
<div class="outline-text-4" id="text-11-3-1">
<p>
Escape fails in Helm, Js2 refactor, and I'm sure other various places
</p>
</div>
</div>
</div>


<div id="outline-container-sec-11-4" class="outline-3">
<h3 id="sec-11-4">Evil vs mutliple-cursors</h3>
<div class="outline-text-3" id="text-11-4">
<p>
Multiple cursors and evil <a href="https://github.com/magnars/multiple-cursors.el/issues/17">don't play well together</a>. I ripped this
solution from <a href="https://github.com/jcpetkovich/.emacs.d">these configs</a>. It disables evil while multiple-cursors
is running. I don't really use multiple cursors, since not being
able to use evil creates dissonance; But js2-refactor does. This
allows js2-refactor to still work nicely for me.
</p>

<div class="org-src-container">

<div class="invert"><pre><code class="language-scheme">(defun user-utils/evil-visual-or-normal-p ()
  "True if evil mode is enabled, and we are in normal or visual mode."
  (and (bound-and-true-p evil-mode)
       (not (memq evil-state '(insert emacs)))))

(defun mc-evil-compat/switch-to-emacs-state ()
  (when (user-utils/evil-visual-or-normal-p)

    (setq mc-evil-compat/evil-prev-state evil-state)

    (when (region-active-p)
      (setq mc-evil-compat/mark-was-active t))

    (let ((mark-before (mark))
	  (point-before (point)))

      (evil-emacs-state 1)

      (when (or mc-evil-compat/mark-was-active (region-active-p))
	(goto-char point-before)
	(set-mark mark-before)))))

(defun mc-evil-compat/back-to-previous-state ()
  (when mc-evil-compat/evil-prev-state
    (unwind-protect
	(case mc-evil-compat/evil-prev-state
	  ((normal visual) (evil-force-normal-state))
	  (t (message "Don't know how to handle previous state: %S"
		      mc-evil-compat/evil-prev-state)))
      (setq mc-evil-compat/evil-prev-state nil)
      (setq mc-evil-compat/mark-was-active nil))))

(add-hook 'multiple-cursors-mode-enabled-hook
	  'mc-evil-compat/switch-to-emacs-state)
(add-hook 'multiple-cursors-mode-disabled-hook
	  'mc-evil-compat/back-to-previous-state)

(defun mc-evil-compat/rectangular-switch-state ()
  (if rectangular-region-mode
      (mc-evil-compat/switch-to-emacs-state)
    (setq mc-evil-compat/evil-prev-state nil)))

;; When running edit-lines, point will return (position + 1) as a
;; result of how evil deals with regions
(defadvice mc/edit-lines (before change-point-by-1 activate)
  (when (user-utils/evil-visual-or-normal-p)
    (if (&gt; (point) (mark))
	(goto-char (1- (point)))
      (push-mark (1- (mark))))))

(add-hook 'rectangular-region-mode-hook 'mc-evil-compat/rectangular-switch-state)

(defvar mc--default-cmds-to-run-once nil)
</code></pre></div>
</div>
</div>
</div>
</div>

<div id="outline-container-sec-12" class="outline-2">
<h2 id="sec-12"><span class="todo TODO">TODO</span> Investigate helm swoop</h2>
<div class="outline-text-2" id="text-12">
<p>
This looks pretty powerful, and may replace any need for multiple
cursors (for my editing needs). Confirm it plays nice with evil.
</p>
</div>
</div>


<div id="outline-container-sec-13" class="outline-2">
<h2 id="sec-13"><span class="todo TODO">TODO</span> Bring in node REPL mode from chromebook</h2>
<div class="outline-text-2" id="text-13">
<ul class="org-ul">
<li><code>[&nbsp;]</code> configure for es6 with 6to5
</li>
<li><code>[&nbsp;]</code> Clean up implementation
</li>
<li><code>[&nbsp;]</code> pull from chromebook into master
</li>
</ul>
</div>
</div>
</article><footer class="invert"> <div class="pager"><a href="/posts/i3-finder/"><i class="fa fa-arrow-left"></i> I3 finder</a><a href="/posts/hello-world/">hello world <i class="fa fa-arrow-right"></i></a></div><div id="disqus_thread" class="invert"></div><script type="text/javascript">/* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
var disqus_shortname = 'thrownforaloop'; // required: replace example with your forum shortname

/* * * DON'T EDIT BELOW THIS LINE * * */
(function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();
</script></footer></div><div id="side" class="col-md-4"><nav id="affix-nav" data-spy="affix" data-offset-top="125"><ul class="nav nav-stacked nav-pills"><li><a href="#page-header">Emacs Configuration</a></li><li><a href="#sec-1">About</a></li><li><a href="#sec-2">Emacs initialization</a></li><li><a href="#sec-3">Javascript</a></li><li><a href="#sec-4">Jade</a></li><li><a href="#sec-5">elisp</a></li><li><a href="#sec-6">Snippets And Autocompletion</a></li><li><a href="#sec-7">Custom Commands</a></li><li><a href="#sec-8">Org-mode</a></li><li><a href="#sec-9">Global Key Bindings</a></li><li><a href="#sec-10">Evil Key Bindings</a></li><li><a href="#sec-11">Evil</a></li><li><a href="#sec-12">TODO Investigate helm swoop</a></li><li><a href="#sec-13">TODO Bring in node REPL mode from chromebook</a></li><li><a href="#disqus_thread">comments</a></li></ul></nav></div></div></div><script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script><!-- script.--><!--     $('h2,h3,h4').attr('data-spy','affix')--><script type="text/javascript" src="/js/bootstrap.min.js"></script><script type="text/javascript" src="/js/prism.js"></script><!-- script.--><!--     $(document).ready(function(){--><!--         $("#sid").affix({--><!--             offset: { --><!--                 top: 190 --><!--             }--><!--         });--><!--     });-->
</html>